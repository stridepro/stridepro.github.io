<!DOCTYPE HTML>
<html>
	<head>
		<title>stridePRO: free analysis of walking, running, and movement</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->

<style type="text/css">

button { 
}

#upload {
	display: none;
}

.prompted #prompt {
	display: none;
}

.prompted #upload {
	display: block;
}

#upload { 
	max-width: 700px;
	width: 100%;
}

label { 
	border-bottom: 2px solid gray;
	display: block;
	width: 100%;
	padding-bottom: 1px;
}

input[type="file"] {
	margin-left: 10px;
}

input[type="text"] {
	display: inline-block;
	width: 40%;
}

button { 
	display: block;
	margin-top: 10px;
	max-width: 300px;
	width: 100%;
}

</style>
		
<script src="https://sdk.amazonaws.com/js/aws-sdk-2.2.4.min.js"></script>
<script language="javascript">
function prompted() { 
	document.body.className += 'prompted';
}

// IAM user which can upload new videos. And that's it.   
AWS.config.update(
	{accessKeyId: 'AKIAITW7U6FXAO6YQH5A', 
	 secretAccessKey: '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',
	 region: 'us-east-1',
	 sslEnabled: true});
	  
var db = new AWS.DynamoDB({params: {TableName: 'stridepro'}});
var bucket = new AWS.S3({params: {Bucket: 'stridepro'}});

function upload() {
	var submit = document.getElementById('submit');
	submit.disabled = true;
	submit.innerHTML = 'Uploading...';
	
	var at = Date.now();
	var contact = document.getElementById('contact').value;
	var note = document.getElementById('note').value;
	var folder = 'videos/' + encodeURIComponent(contact) + '/' + at;

	db.putItem(
		{Item: 
			{uploadId: {S: folder}, 
			 contact: {S: contact},
			 at: {S: at},
			 note: {S: note}}
		}, 
		function() {
			var files = document.getElementById('videos').files;
			for (var i = 0; i < files.length; i++) {
				var file = files[i];
				var key = folder + '/' + file.name;
			
				bucket.upload(
					{Key: key, ContentType: file.type, Body: file},
					function (err, data) {
						document.getElementById('progress').innerHTML = (err ? 'ERROR!' : 'UPLOADED.');
				});
			}
		}
	);
}
	
</script>
	<body>
	
		<!-- Header -->
			<header id="header">
				<h1>Free motion analysis</h1>
				<p>A simple template for telling the world when you'll launch<br />
				your next big thing. Brought to you by <a href="http://html5up.net">HTML5 UP</a>.</p>
			</header>

		<!-- Form -->
			<button id="prompt" onclick="prompted()">Free stride analysis (submit video) &rarr;</button>
			<form id="upload">
				<label>Stride video(s): <input type="file" id="videos"  multiple required /></label>
				<input type="text" id="contact" placeholder="Email address or Instagram username" size="30" required />
				<input type="text" id="note" placeholder="Why do you want stride analysis?" />
				<button id="submit" onclick="try { upload() } catch(e) { console.log(e) } finally { return false }">Submit for free analysis &rarr;</button>
				<div id="progress"></div>
			</form>		

		<!-- Footer -->
			<footer id="footer">
				<ul class="icons">
					<li><a href="//instagram.com/stridepro" class="icon fa-instagram"><span class="label">Instagram</span></a></li>
					<li><a href="//www.facebook.com/StridePro-864437257004648" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
					<li><a href="mnailto:hello@stride.pro" class="icon fa-envelope-o"><span class="label">Email</span></a></li>
				</ul>
				<!--
				<ul class="copyright">
					<li>&copy; Untitled.</li><li>Credits: <a href="http://html5up.net">HTML5 UP</a></li>
				</ul>
				-->
			</footer>

		<!-- Scripts -->
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>

	</body>
</html>